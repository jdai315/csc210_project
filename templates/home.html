{% extends 'base.html' %}

{% block content %}

{% set active_page = "home" %}

{% set navigation_bar = [
('/home', 'home', 'Home'),
('/addstory', 'addStory', 'Add Story'),
('/logout', 'logout', 'Logout'),
] -%}

<link rel="stylesheet" href="../static/css/layouts/animate.css">
<link rel="stylesheet" href="../static/css/layouts/email.css">

<!-- load jQuery -->
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

<script>
    function loadXMLDoc()
    {
        var req = new XMLHttpRequest()
        req.onreadystatechange = function()
        {
            if (req.readyState == 4)
            {
                if (req.status != 200)
                {
                    console.log("error")
                }
                else
                {
                    console.log("working!")
                    var response = JSON.parse(req.responseText)
                        // create a new div element
                        // and give it some content
                    
                    var newDiv = document.createElement("div")
                    newDiv.className += "email-item pure-g"
                    
                    var childDiv = document.createElement("div")
                    newDiv.className += "pure-u-3-4"
                    
                    var span1 = document.createElement("span")
                    span1.className += "email-label-mine"
                    
                    var h5 = document.createElement("h5")
                    h5.className += "email-name"
                    
                    var h4 = document.createElement("h4")
                    h4.className += "email-subject"
                    
                    var pdate = document.createElement("p")
                    pdate.className += "email-date"
                    
                    var span2 = document.createElement("span")
                    
                    var pdesc = document.createElement("p")
                    pdesc.style.wordwrap = "break-word"
                    pdesc.className += "email-desc cut-off"
                    
                
                    
                    var newTitle = document.createTextNode(response.title)
                    var newContent = document.createTextNode(response.content)
                    var name = document.createTextNode(response.user)
                    
                    pdesc.appendChild(newContent)
                    h4.appendChild(newTitle)
                    h5.appendChild(name)
                    
                    childDiv.appendChild(pdesc)
                    childDiv.insertBefore(pdate, pdesc)
                    childDiv.insertBefore(h4, pdate)
                    childDiv.insertBefore(h5, h4)
                    childDiv.insertBefore(span1, h5)
                    newDiv.appendChild(childDiv) //add the text node to the newly created div.
                        
                        // add the newly created element and its content into the DOM
                    var currentDiv = document.getElementById("ajaxposts")
                    
                    var list = document.getElementById("list")   // Get the <ul> element to insert a new node
                    list.insertBefore(newDiv, currentDiv)
                    
                    //$( "#ajaxposts" ).before( newDiv )
                
                    
                }
            }
        }
        
        req.open('POST', '/ajax')
        req.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
        var tit = document.getElementById('title').value
        var con = document.getElementById('content').value
        var postVars = 'title='+tit+'&content='+con
        req.send(postVars)
        
        return false
    }
</script>


<!-- 
 
 <div class="email-item pure-g">
 <div class="pure-u-3-4">
 <span class="email-label-mine"></span>
 <h5 class="email-name"> </h5>
 
 <h4 class="email-subject"></h4>
 <p class="email-date"><span></span></p>
 <p style="word-wrap: break-word" class="email-desc cut-off">
 </p>
 </div>
 </div>
 
 -->
<!-- document.getElementById('bro').innerHTML = response.title      document.body.insertBefore(newDiv, currentDiv)-->
<!--
<script>
 
$(function() {
      $('#btn').click(function() {
            var data = JSON.stringify($('.myForm').serializeArray());
            console.log(data);
            $.ajax({
                url: '/ajax',
                data: data,
                type: 'POST',
                success: function(response) {
                   console.log('testing');
                   console.log(response);
                },
                error: function(error) {
                   console.log(error);
                }
            });
      });
});
      
</script>
 -->

<!--
    <div class="header">
  <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
    <a class="pure-menu-heading" href="/home">Novel</a>
    
    <ul class="pure-menu-list">
      {% for href, id, caption in navigation_bar %}
      <li class="pure-menu-item {% if id == active_page %}pure-menu-selected{% endif %}"><a href="{{ href|e }}" class="pure-menu-link">{{ caption|e }}</a></li>
      {% endfor %}
    </ul>
  </div>
    </div>
    -->

<!--website body-->

<div id="addStory" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">x</span>
            <h2 class="modal-text"> Add a story </h2>
        </div>
        <div class="modal-body" style="padding: 40px;">
            <form method="POST" class="myForm pure-form pure-form-stacked">
                <fieldset>
                    <label for="title">Story Title</label>
                    <input name="title" id="title" type="text" class="pure-input-1" placeholder="Title">
                        
                        <label for="content">Story Content</label>
                        <textarea name="content" id="content" class="pure-input-1" placeholder="Write here!"></textarea>
                        </fieldset>
                <button type="submit" id="submit" class="pure-button pure-input-1-3 pure-button-primary is-center">Submit</button>
                
            </form>
        </div>
        <div class="modal-footer">

        </div>
    </div>
</div>

<div id="layout" class="content pure-g buffer">
  
  <div id="nav" class="pure-u">
    <a href="/home" class="nav-menu-button">Menu</a>
    
    <div class="nav-inner">
      
      <div class="pure-u">
	<ul class="pure-menu-list">
        <li class="pure-menu-item"><a href="/home" class="pure-menu-link">Welcome {{user}}!</a>
</li>
	</ul>
      </div>
      
      <button id="modalBtn" class="primary-button pure-button">Add New Story</button>
      
      <div class="pure-menu">
        <ul class="pure-menu-list">
          <li class="pure-menu-item"><a href="/home" class="pure-menu-link">View Profile</a></li>
          <li class="pure-menu-item"><a href="/logout" class="pure-menu-link">Logout</a></li>
	  
          <li class="pure-menu-heading">Filter Feed</li>
          <li class="pure-menu-item"><a href="/home/all" class="pure-menu-link filter"><span>All Stories</span></a></li>
	  <li class="pure-menu-item"><a href="/home/mine" class="pure-menu-link filter"><span class="email-label-mine"></span>My Stories</a></li>
	  <li class="pure-menu-item"><a href="/home/others" class="pure-menu-link filter"><span class="email-label-others"></span>Other Stories</a></li>
	</ul>
      </div>
      
    </div>
  </div>
  
  {% if contents[0] != null %}

  <div id="list" class="pure-u-1">
      
    <div id="ajaxposts"></div>
    {% for content in contents %}
    <div class="email-item pure-g">
        <div class="pure-u-3-4">
          {% if content[3]|safe == user %}
	  <span class="email-label-mine"></span> {% else %} <span class="email-label-others"></span> {% endif %} <h5 class="email-name">{{ content[3]|safe }} </h5>
          
          <h4 class="email-subject">{{ content[0]|safe }} </h4>
	  <p class="email-date"><span>{{ content[2]|safe }} </span></p>
          <p style="word-wrap: break-word" class="email-desc cut-off">
            {{ content[1]|safe }}
          </p>
        </div>
    </div>
    {% endfor %}
    

  <!-- email-item-selected is a class in the email item -->
    
  </div>
  
  <div id="main" class="pure-u-1">
    <div class="email-content">
      <div class="email-content-header pure-g">
        <div class="pure-u-1-2">
          <h1 class="email-content-title"></h1>
          <p class="email-content-subtitle">
          From <a class="email-content-author"></a> at <span class="email-content-date"></span>
          </p>
        </div>
        <div class="email-content-controls pure-u-1-2">

          <script type ="text/javascript">

          var Upvote = 0
          function pClick(){
            Upvote += 1;
            document.getElementById("Upvote").innerHTML = Upvote;
          };
          </script>
          <button class="button-success pure-button" onClick="pClick()">Upvote</button>
          <p>Clicks: <a id="Upvote">0</a></p>

           <script type ="text/javascript">

          var dVote = 0
          function dClick(){
            dVote += 1;
            document.getElementById("dVote").innerHTML = dVote;
          };
          </script>
          <button class="button-error pure-button" onClick="dClick()">dVote</button>
          <p>Clicks: <a id="dVote">0</a></p>
          <button class="secondary-button pure-button edit">Edit Story</button>
          <button class="secondary-button pure-button delete">Delete Story</button>

        </div>
      </div>
      
      <div style="word-wrap: break-word" class="email-content-body"><img src="static/img/icons/doc.png" width="256">
      </div>
      
    </div>
  </div>

  {% else %}
  <div id="main" class="pure-u-1-2 nostory">
    <h1 class="email-content-title">You have no stories! Click 'Add New Story' to get started!</h1>
  </div>
  {% endif %}
  
</div>


<!-- include JS -->
<script type="text/javascript" src="/static/home1.js"></script>
<script type="text/javascript" src="/static/ajax.js"></script>
<script src="http://yui.yahooapis.com/3.17.2/build/yui/yui-min.js"></script>

{% endblock %}
